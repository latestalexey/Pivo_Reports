<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema">
		<dataSource>
			<name>ИсточникДанных1</name>
			<dataSourceType>Local</dataSourceType>
		</dataSource>
		<dataSet xsi:type="DataSetQuery">
			<name>НаборДанных1</name>
			<field xsi:type="DataSetFieldField">
				<dataPath>Прибыль</dataPath>
				<field>Прибыль</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Прибыль</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Количество</dataPath>
				<field>Количество</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Количество</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Себестоимость</dataPath>
				<field>Себестоимость</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Себестоимость</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Магазин</dataPath>
				<field>Магазин</field>
				<role>
					<dimension xmlns="http://v8.1c.ru/8.1/data-composition-system/common">true</dimension>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Сумма</dataPath>
				<field>Сумма</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Сумма</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Регистратор</dataPath>
				<field>Регистратор</field>
				<role>
					<periodNumber xmlns="http://v8.1c.ru/8.1/data-composition-system/common">1</periodNumber>
					<periodType xmlns="http://v8.1c.ru/8.1/data-composition-system/common">Main</periodType>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Номенклатура</dataPath>
				<field>Номенклатура</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Номенклатура</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Подарок</dataPath>
				<field>Подарок</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Подарок</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>День</dataPath>
				<field>День</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>День</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>СуммаСкидки</dataPath>
				<field>СуммаСкидки</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Сумма скидки</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>СуммаБезСкидки</dataPath>
				<field>СуммаБезСкидки</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Сумма без скидки</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<dataSource>ИсточникДанных1</dataSource>
			<query>ВЫБРАТЬ
	ПродажиОбороты.Магазин КАК Магазин,
	ПродажиОбороты.Склад,
	ПродажиОбороты.Номенклатура КАК Номенклатура,
	СУММА(ПродажиОбороты.КоличествоОборот) КАК Количество,
	СУММА(ПродажиОбороты.СтоимостьОборот) КАК Сумма,
	ПродажиОбороты.Магазин.ПравилоЦенообразования.ВидЦен КАК ВидЦены,
	НАЧАЛОПЕРИОДА(ПродажиОбороты.Период, ДЕНЬ) КАК Период,
	ПродажиОбороты.Регистратор
ПОМЕСТИТЬ Продажи
{ВЫБРАТЬ
	Магазин.*}
ИЗ
	РегистрНакопления.Продажи.Обороты(&amp;ДатаНач, &amp;ДатаКон, Запись, ) КАК ПродажиОбороты

СГРУППИРОВАТЬ ПО
	ПродажиОбороты.Магазин,
	ПродажиОбороты.Склад,
	ПродажиОбороты.Номенклатура,
	ПродажиОбороты.Магазин.ПравилоЦенообразования.ВидЦен,
	ПродажиОбороты.Регистратор,
	НАЧАЛОПЕРИОДА(ПродажиОбороты.Период, ДЕНЬ)

ИНДЕКСИРОВАТЬ ПО
	Номенклатура,
	ВидЦены
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КомплектующиеНоменклатуры.Номенклатура КАК Номенклатура,
	КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая,
	Продажи.ВидЦены КАК ВидЦены,
	Продажи.Период,
	КомплектующиеНоменклатуры.Количество
ПОМЕСТИТЬ Комплектующие
ИЗ
	Продажи КАК Продажи
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
		ПО Продажи.Номенклатура = КомплектующиеНоменклатуры.Номенклатура

ИНДЕКСИРОВАТЬ ПО
	Комплектующая,
	ВидЦены,
	Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.ВидЦены КАК ВидЦены,
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.Период КАК Период,
	МАКСИМУМ(ВложенныйЗапрос.Цена) КАК Цена
ПОМЕСТИТЬ ТабВсеЦены
ИЗ
	(ВЫБРАТЬ
		ЦеныНоменклатуры.ВидЦены КАК ВидЦены,
		ЦеныНоменклатуры.Номенклатура КАК Номенклатура,
		НАЧАЛОПЕРИОДА(ЦеныНоменклатуры.Период, ДЕНЬ) КАК Период,
		ЦеныНоменклатуры.Цена КАК Цена
	ИЗ
		РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
	ГДЕ
		ЦеныНоменклатуры.Период МЕЖДУ &amp;ДатаНач И &amp;ДатаКон
		И ЦеныНоменклатуры.Номенклатура В
				(ВЫБРАТЬ
					Комплектующие.Комплектующая
				ИЗ
					Комплектующие КАК Комплектующие
			
				ОБЪЕДИНИТЬ ВСЕ
			
				ВЫБРАТЬ
					Продажи.Номенклатура
				ИЗ
					Продажи КАК Продажи)
		И ЦеныНоменклатуры.ВидЦены В
				(ВЫБРАТЬ
					Комплектующие.ВидЦены
				ИЗ
					Комплектующие КАК Комплектующие
			
				ОБЪЕДИНИТЬ ВСЕ
			
				ВЫБРАТЬ
					Продажи.ВидЦены
				ИЗ
					Продажи КАК Продажи)
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ЦеныНоменклатурыСрезПоследних.ВидЦены,
		ЦеныНоменклатурыСрезПоследних.Номенклатура,
		НАЧАЛОПЕРИОДА(&amp;ДатаКон, ДЕНЬ),
		ЦеныНоменклатурыСрезПоследних.Цена
	ИЗ
		РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
				&amp;ДатаКон,
				Номенклатура В
						(ВЫБРАТЬ
							Комплектующие.Комплектующая
						ИЗ
							Комплектующие КАК Комплектующие
				
						ОБЪЕДИНИТЬ ВСЕ
				
						ВЫБРАТЬ
							Продажи.Номенклатура
						ИЗ
							Продажи КАК Продажи)
					И ВидЦены В
						(ВЫБРАТЬ
							Комплектующие.ВидЦены
						ИЗ
							Комплектующие КАК Комплектующие
				
						ОБЪЕДИНИТЬ ВСЕ
				
						ВЫБРАТЬ
							Продажи.ВидЦены
						ИЗ
							Продажи КАК Продажи)) КАК ЦеныНоменклатурыСрезПоследних
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ЦеныНоменклатурыСрезПоследних.ВидЦены,
		ЦеныНоменклатурыСрезПоследних.Номенклатура,
		НАЧАЛОПЕРИОДА(&amp;ДатаНач, ДЕНЬ),
		ЦеныНоменклатурыСрезПоследних.Цена
	ИЗ
		РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
				&amp;ДатаНач,
				Номенклатура В
						(ВЫБРАТЬ
							Комплектующие.Комплектующая
						ИЗ
							Комплектующие КАК Комплектующие
				
						ОБЪЕДИНИТЬ ВСЕ
				
						ВЫБРАТЬ
							Продажи.Номенклатура
						ИЗ
							Продажи КАК Продажи)
					И ВидЦены В
						(ВЫБРАТЬ
							Комплектующие.ВидЦены
						ИЗ
							Комплектующие КАК Комплектующие
				
						ОБЪЕДИНИТЬ ВСЕ
				
						ВЫБРАТЬ
							Продажи.ВидЦены
						ИЗ
							Продажи КАК Продажи)) КАК ЦеныНоменклатурыСрезПоследних) КАК ВложенныйЗапрос

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.Номенклатура,
	ВложенныйЗапрос.ВидЦены,
	ВложенныйЗапрос.Период

ИНДЕКСИРОВАТЬ ПО
	ВидЦены,
	Номенклатура,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.ВидЦены КАК ВидЦены,
	ВложенныйЗапрос.ПериодДок КАК ПериодДок,
	ВложенныйЗапрос.ПериодЦены,
	ТабВсеЦены.Цена
ПОМЕСТИТЬ ТабЦеныСПериодами
ИЗ
	(ВЫБРАТЬ
		ТабВсеЦены.ВидЦены КАК ВидЦены,
		ТабВсеЦены.Номенклатура КАК Номенклатура,
		Комплектующие.Период КАК ПериодДок,
		МАКСИМУМ(ТабВсеЦены.Период) КАК ПериодЦены
	ИЗ
		Комплектующие КАК Комплектующие
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабВсеЦены КАК ТабВсеЦены
			ПО Комплектующие.Комплектующая = ТабВсеЦены.Номенклатура
				И Комплектующие.ВидЦены = ТабВсеЦены.ВидЦены
				И Комплектующие.Период &gt;= ТабВсеЦены.Период
	
	СГРУППИРОВАТЬ ПО
		ТабВсеЦены.Номенклатура,
		ТабВсеЦены.ВидЦены,
		Комплектующие.Период
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ТабВсеЦены.ВидЦены,
		ТабВсеЦены.Номенклатура,
		Продажи.Период,
		МАКСИМУМ(ТабВсеЦены.Период)
	ИЗ
		Продажи КАК Продажи
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабВсеЦены КАК ТабВсеЦены
			ПО Продажи.Номенклатура = ТабВсеЦены.Номенклатура
				И Продажи.ВидЦены = ТабВсеЦены.ВидЦены
				И Продажи.Период &gt;= ТабВсеЦены.Период
	
	СГРУППИРОВАТЬ ПО
		ТабВсеЦены.Номенклатура,
		ТабВсеЦены.ВидЦены,
		Продажи.Период) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабВсеЦены КАК ТабВсеЦены
		ПО ВложенныйЗапрос.ВидЦены = ТабВсеЦены.ВидЦены
			И ВложенныйЗапрос.Номенклатура = ТабВсеЦены.Номенклатура
			И ВложенныйЗапрос.ПериодЦены = ТабВсеЦены.Период

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.Номенклатура,
	ВложенныйЗапрос.ВидЦены,
	ВложенныйЗапрос.ПериодДок,
	ВложенныйЗапрос.ПериодЦены,
	ТабВсеЦены.Цена

ИНДЕКСИРОВАТЬ ПО
	ПериодДок,
	Номенклатура,
	ВидЦены
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Комплектующие.Номенклатура КАК Номенклатура,
	Комплектующие.Комплектующая КАК Комплектующая,
	Комплектующие.ВидЦены КАК ВидЦены,
	Комплектующие.Период КАК Период,
	МАКСИМУМ(ЕСТЬNULL(ТабЦеныСПериодами.Цена, 0)) КАК Цена,
	Комплектующие.Количество,
	Комплектующие.Количество * ЕСТЬNULL(ТабЦеныСПериодами.Цена, 0) КАК Сумма
ПОМЕСТИТЬ КомплектующиеСЦенами
ИЗ
	Комплектующие КАК Комплектующие
		ЛЕВОЕ СОЕДИНЕНИЕ ТабЦеныСПериодами КАК ТабЦеныСПериодами
		ПО Комплектующие.Комплектующая = ТабЦеныСПериодами.Номенклатура
			И Комплектующие.ВидЦены = ТабЦеныСПериодами.ВидЦены
			И Комплектующие.Период = ТабЦеныСПериодами.ПериодДок

СГРУППИРОВАТЬ ПО
	Комплектующие.ВидЦены,
	Комплектующие.Номенклатура,
	Комплектующие.Период,
	Комплектующие.Комплектующая,
	Комплектующие.Количество,
	Комплектующие.Количество * ЕСТЬNULL(ТабЦеныСПериодами.Цена, 0)

ИНДЕКСИРОВАТЬ ПО
	ВидЦены,
	Номенклатура,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КомплектующиеСЦенами.Номенклатура КАК Номенклатура,
	КомплектующиеСЦенами.Комплектующая,
	КомплектующиеСЦенами.ВидЦены КАК ВидЦены,
	КомплектующиеСЦенами.Период КАК Период,
	ВЫБОР
		КОГДА ВложенныйЗапрос.Сумма = 0
			ТОГДА 1 / ВложенныйЗапрос.КоличествоКомплектующих
		ИНАЧЕ КомплектующиеСЦенами.Сумма / ВложенныйЗапрос.Сумма
	КОНЕЦ КАК КоофицентУчастия,
	КомплектующиеСЦенами.Цена,
	КомплектующиеСЦенами.Количество,
	КомплектующиеСЦенами.Сумма
ПОМЕСТИТЬ КомплектующиеСКоофицентами
ИЗ
	(ВЫБРАТЬ
		КомплектующиеСЦенами.ВидЦены КАК ВидЦены,
		КомплектующиеСЦенами.Период КАК Период,
		КомплектующиеСЦенами.Номенклатура КАК Номенклатура,
		СУММА(КомплектующиеСЦенами.Сумма) КАК Сумма,
		1 КАК КоличествоКомплектующих
	ИЗ
		КомплектующиеСЦенами КАК КомплектующиеСЦенами
	
	СГРУППИРОВАТЬ ПО
		КомплектующиеСЦенами.ВидЦены,
		КомплектующиеСЦенами.Период,
		КомплектующиеСЦенами.Номенклатура) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КомплектующиеСЦенами КАК КомплектующиеСЦенами
		ПО ВложенныйЗапрос.ВидЦены = КомплектующиеСЦенами.ВидЦены
			И ВложенныйЗапрос.Номенклатура = КомплектующиеСЦенами.Номенклатура
			И ВложенныйЗапрос.Период = КомплектующиеСЦенами.Период

ИНДЕКСИРОВАТЬ ПО
	ВидЦены,
	Период,
	Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Продажи.Магазин КАК Магазин,
	Продажи.Период КАК Период,
	Продажи.Регистратор,
	ВЫБОР
		КОГДА КомплектующиеСКоофицентами.Комплектующая ЕСТЬ NULL 
			ТОГДА Продажи.Номенклатура
		ИНАЧЕ КомплектующиеСКоофицентами.Комплектующая
	КОНЕЦ КАК Номенклатура,
	ВЫБОР
		КОГДА КомплектующиеСКоофицентами.Комплектующая ЕСТЬ NULL 
			ТОГДА Продажи.Количество
		ИНАЧЕ Продажи.Количество * КомплектующиеСКоофицентами.Количество
	КОНЕЦ КАК Количество,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА КомплектующиеСКоофицентами.Комплектующая ЕСТЬ NULL 
				ТОГДА Продажи.Сумма
			ИНАЧЕ Продажи.Сумма * КомплектующиеСКоофицентами.КоофицентУчастия
		КОНЕЦ КАК ЧИСЛО(15, 2)) КАК Сумма,
	"Продажа" КАК Подарок,
	ВЫРАЗИТЬ(ЕСТЬNULL(ТабЦеныСПериодами.Цена, 0) * ВЫБОР
			КОГДА КомплектующиеСКоофицентами.Комплектующая ЕСТЬ NULL 
				ТОГДА Продажи.Количество
			ИНАЧЕ Продажи.Количество * КомплектующиеСКоофицентами.КоофицентУчастия
		КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаБезСкидки
ПОМЕСТИТЬ ТабПродажиРаскомплектовано
ИЗ
	Продажи КАК Продажи
		ЛЕВОЕ СОЕДИНЕНИЕ КомплектующиеСКоофицентами КАК КомплектующиеСКоофицентами
		ПО Продажи.ВидЦены = КомплектующиеСКоофицентами.ВидЦены
			И Продажи.Период = КомплектующиеСКоофицентами.Период
			И Продажи.Номенклатура = КомплектующиеСКоофицентами.Номенклатура
		ЛЕВОЕ СОЕДИНЕНИЕ ТабЦеныСПериодами КАК ТабЦеныСПериодами
		ПО Продажи.Номенклатура = ТабЦеныСПериодами.Номенклатура
			И Продажи.ВидЦены = ТабЦеныСПериодами.ВидЦены
			И Продажи.Период = ТабЦеныСПериодами.ПериодДок

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЧекККМПодарки.Ссылка.Магазин,
	НАЧАЛОПЕРИОДА(ЧекККМПодарки.Ссылка.Дата, ДЕНЬ),
	ЧекККМПодарки.Ссылка,
	ЧекККМПодарки.Номенклатура,
	ЧекККМПодарки.КоличествоУпаковок,
	0,
	ВЫБОР
		КОГДА ЧекККМПодарки.НеПодарок
			ТОГДА "Продажа"
		ИНАЧЕ "Подарок"
	КОНЕЦ,
	ЧекККМПодарки.Сумма
ИЗ
	Документ.ЧекККМ.Подарки КАК ЧекККМПодарки
ГДЕ
	ЧекККМПодарки.Ссылка.Проведен
	И ЧекККМПодарки.Ссылка.Дата МЕЖДУ &amp;ДатаНач И &amp;ДатаКон

ИНДЕКСИРОВАТЬ ПО
	Магазин,
	Номенклатура,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.Период КАК Период,
	ВложенныйЗапрос.Магазин КАК Магазин,
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	МАКСИМУМ(ВложенныйЗапрос.Цена) КАК Цена
ПОМЕСТИТЬ ТабВсяСебестоимость
ИЗ
	(ВЫБРАТЬ
		НАЧАЛОПЕРИОДА(СебестоимостьНоменклатуры.Период, ДЕНЬ) КАК Период,
		СебестоимостьНоменклатуры.Магазин КАК Магазин,
		СебестоимостьНоменклатуры.Номенклатура КАК Номенклатура,
		СебестоимостьНоменклатуры.Цена КАК Цена
	ИЗ
		РегистрСведений.СебестоимостьНоменклатуры КАК СебестоимостьНоменклатуры
	ГДЕ
		СебестоимостьНоменклатуры.Период МЕЖДУ &amp;ДатаНач И &amp;ДатаКон
		И СебестоимостьНоменклатуры.Магазин В
				(ВЫБРАТЬ
					ТабПродажиРаскомплектовано.Магазин
				ИЗ
					ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)
		И СебестоимостьНоменклатуры.Номенклатура В
				(ВЫБРАТЬ
					ТабПродажиРаскомплектовано.Номенклатура
				ИЗ
					ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		НАЧАЛОПЕРИОДА(&amp;ДатаКон, ДЕНЬ),
		СебестоимостьНоменклатурыСрезПоследних.Магазин,
		СебестоимостьНоменклатурыСрезПоследних.Номенклатура,
		СебестоимостьНоменклатурыСрезПоследних.Цена
	ИЗ
		РегистрСведений.СебестоимостьНоменклатуры.СрезПоследних(
				&amp;ДатаКон,
				Магазин В
						(ВЫБРАТЬ
							ТабПродажиРаскомплектовано.Магазин
						ИЗ
							ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)
					И Номенклатура В
						(ВЫБРАТЬ
							ТабПродажиРаскомплектовано.Номенклатура
						ИЗ
							ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)) КАК СебестоимостьНоменклатурыСрезПоследних
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		НАЧАЛОПЕРИОДА(&amp;ДатаНач, ДЕНЬ),
		СебестоимостьНоменклатурыСрезПоследних.Магазин,
		СебестоимостьНоменклатурыСрезПоследних.Номенклатура,
		СебестоимостьНоменклатурыСрезПоследних.Цена
	ИЗ
		РегистрСведений.СебестоимостьНоменклатуры.СрезПоследних(
				&amp;ДатаНач,
				Магазин В
						(ВЫБРАТЬ
							ТабПродажиРаскомплектовано.Магазин
						ИЗ
							ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)
					И Номенклатура В
						(ВЫБРАТЬ
							ТабПродажиРаскомплектовано.Номенклатура
						ИЗ
							ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано)) КАК СебестоимостьНоменклатурыСрезПоследних) КАК ВложенныйЗапрос

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.Номенклатура,
	ВложенныйЗапрос.Магазин,
	ВложенныйЗапрос.Период

ИНДЕКСИРОВАТЬ ПО
	Период,
	Номенклатура,
	Магазин
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.Магазин КАК Магазин,
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.ПериодДок КАК ПериодДок,
	ВложенныйЗапрос.ПериодСебестоимости,
	ТабВсяСебестоимость.Цена
ПОМЕСТИТЬ ТабСебестоимостьСПериодами
ИЗ
	ТабВсяСебестоимость КАК ТабВсяСебестоимость
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ТабПродажиРаскомплектовано.Магазин КАК Магазин,
			ТабПродажиРаскомплектовано.Номенклатура КАК Номенклатура,
			ТабПродажиРаскомплектовано.Период КАК ПериодДок,
			МАКСИМУМ(ТабВсяСебестоимость.Период) КАК ПериодСебестоимости
		ИЗ
			ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабВсяСебестоимость КАК ТабВсяСебестоимость
				ПО ТабПродажиРаскомплектовано.Магазин = ТабВсяСебестоимость.Магазин
					И ТабПродажиРаскомплектовано.Номенклатура = ТабВсяСебестоимость.Номенклатура
					И ТабПродажиРаскомплектовано.Период &gt;= ТабВсяСебестоимость.Период
		
		СГРУППИРОВАТЬ ПО
			ТабПродажиРаскомплектовано.Номенклатура,
			ТабПродажиРаскомплектовано.Магазин,
			ТабПродажиРаскомплектовано.Период) КАК ВложенныйЗапрос
		ПО ТабВсяСебестоимость.Период = ВложенныйЗапрос.ПериодСебестоимости
			И ТабВсяСебестоимость.Магазин = ВложенныйЗапрос.Магазин
			И ТабВсяСебестоимость.Номенклатура = ВложенныйЗапрос.Номенклатура

ИНДЕКСИРОВАТЬ ПО
	Магазин,
	Номенклатура,
	ПериодДок
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТабПродажиРаскомплектовано.Магазин КАК Магазин,
	ТабПродажиРаскомплектовано.Регистратор КАК Регистратор,
	ТабПродажиРаскомплектовано.Номенклатура КАК Номенклатура,
	ТабПродажиРаскомплектовано.Количество КАК Количество,
	ТабПродажиРаскомплектовано.Сумма КАК Сумма,
	ТабПродажиРаскомплектовано.Количество * ЕСТЬNULL(ТабСебестоимостьСПериодами.Цена, 0) КАК Себестоимость,
	ТабПродажиРаскомплектовано.Сумма - ТабПродажиРаскомплектовано.Количество * ЕСТЬNULL(ТабСебестоимостьСПериодами.Цена, 0) КАК Прибыль,
	ТабПродажиРаскомплектовано.Подарок КАК Подарок,
	НАЧАЛОПЕРИОДА(ТабПродажиРаскомплектовано.Регистратор.Дата, ДЕНЬ) КАК День,
	ТабПродажиРаскомплектовано.СуммаБезСкидки КАК СуммаБезСкидки,
	ТабПродажиРаскомплектовано.СуммаБезСкидки - ТабПродажиРаскомплектовано.Сумма КАК СуммаСкидки
{ВЫБРАТЬ
	Магазин.*,
	Регистратор.*,
	Номенклатура.*,
	Количество,
	Сумма,
	Себестоимость,
	Прибыль,
	Подарок,
	День,
	СуммаБезСкидки,
	СуммаСкидки}
ИЗ
	ТабПродажиРаскомплектовано КАК ТабПродажиРаскомплектовано
		ЛЕВОЕ СОЕДИНЕНИЕ ТабСебестоимостьСПериодами КАК ТабСебестоимостьСПериодами
		ПО ТабПродажиРаскомплектовано.Магазин = ТабСебестоимостьСПериодами.Магазин
			И ТабПродажиРаскомплектовано.Номенклатура = ТабСебестоимостьСПериодами.Номенклатура
			И ТабПродажиРаскомплектовано.Период = ТабСебестоимостьСПериодами.ПериодДок
{ГДЕ
	ТабПродажиРаскомплектовано.Магазин.*,
	ТабПродажиРаскомплектовано.Номенклатура.*,
	ТабПродажиРаскомплектовано.Подарок}</query>
			<autoFillFields>false</autoFillFields>
		</dataSet>
		<totalField>
			<dataPath>Количество</dataPath>
			<expression>Сумма(Количество)</expression>
		</totalField>
		<totalField>
			<dataPath>Прибыль</dataPath>
			<expression>Сумма(Прибыль)</expression>
		</totalField>
		<totalField>
			<dataPath>Себестоимость</dataPath>
			<expression>Сумма(Себестоимость)</expression>
		</totalField>
		<totalField>
			<dataPath>Сумма</dataPath>
			<expression>Сумма(Сумма)</expression>
		</totalField>
		<totalField>
			<dataPath>СуммаБезСкидки</dataPath>
			<expression>Сумма(СуммаБезСкидки)</expression>
		</totalField>
		<totalField>
			<dataPath>СуммаСкидки</dataPath>
			<expression>Сумма(СуммаСкидки)</expression>
		</totalField>
		<parameter>
			<name>ДатаНач</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Дата нач</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>true</useRestriction>
			<expression>&amp;СтандартныйПериод.ДатаНачала</expression>
			<denyIncompleteValues>true</denyIncompleteValues>
		</parameter>
		<parameter>
			<name>ДатаКон</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Дата кон</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>true</useRestriction>
			<expression>&amp;СтандартныйПериод.ДатаОкончания</expression>
			<denyIncompleteValues>true</denyIncompleteValues>
		</parameter>
		<parameter>
			<name>СтандартныйПериод</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Стандартный период</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">StandardPeriod</Type>
			</valueType>
			<value xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:StandardPeriod">
				<d4p1:variant xsi:type="d4p1:StandardPeriodVariant">Custom</d4p1:variant>
				<d4p1:startDate>0001-01-01T00:00:00</d4p1:startDate>
				<d4p1:endDate>0001-01-01T00:00:00</d4p1:endDate>
			</value>
			<useRestriction>false</useRestriction>
			<denyIncompleteValues>true</denyIncompleteValues>
		</parameter>
		<settingsVariant>
			<name xmlns="http://v8.1c.ru/8.1/data-composition-system/settings">ПродажиРаскомплектовано</name>
			<presentation xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Продажи раскомплектовано</d4p1:content>
				</d4p1:item>
			</presentation>
		</settingsVariant>
	</dataCompositionSchema>
</SchemaFile>﻿<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<selection>
		<item xsi:type="SelectedItemField">
			<field>Количество</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Сумма</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Себестоимость</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Прибыль</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>СуммаБезСкидки</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>СуммаСкидки</field>
		</item>
	</selection>
	<dataParameters>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:use>false</dcscor:use>
			<dcscor:parameter>СтандартныйПериод</dcscor:parameter>
			<dcscor:value xsi:nil="true"/>
			<userSettingID>068e580b-9242-4581-84b4-634dd88992e3</userSettingID>
		</dcscor:item>
	</dataParameters>
	<conditionalAppearance>
		<item>
			<selection>
				<item>
					<field>Прибыль</field>
				</item>
				<item>
					<field>Себестоимость</field>
				</item>
				<item>
					<field>Сумма</field>
				</item>
			</selection>
			<filter/>
			<appearance>
				<dcscor:item xsi:type="SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</item>
		<item>
			<selection>
				<item>
					<field>Количество</field>
				</item>
			</selection>
			<filter/>
			<appearance>
				<dcscor:item xsi:type="SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=3</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</item>
	</conditionalAppearance>
	<item xsi:type="StructureItemGroup">
		<groupItems>
			<item xsi:type="GroupItemField">
				<field>Магазин</field>
				<groupType>Items</groupType>
				<periodAdditionType>None</periodAdditionType>
				<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
				<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
			</item>
		</groupItems>
		<order>
			<item xsi:type="OrderItemAuto"/>
		</order>
		<selection>
			<item xsi:type="SelectedItemAuto"/>
		</selection>
		<item xsi:type="StructureItemGroup">
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>Подарок</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
			<item xsi:type="StructureItemGroup">
				<groupItems>
					<item xsi:type="GroupItemField">
						<field>Номенклатура</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
				</groupItems>
				<order>
					<item xsi:type="OrderItemAuto"/>
				</order>
				<selection>
					<item xsi:type="SelectedItemAuto"/>
				</selection>
			</item>
		</item>
	</item>
</Settings>﻿<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema"/>
</SchemaFile>